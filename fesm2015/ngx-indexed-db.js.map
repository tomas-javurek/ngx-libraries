{"version":3,"file":"ngx-indexed-db.js","sources":["ng://ngx-indexed-db/lib/ngx-indexed-db.service.ts","ng://ngx-indexed-db/lib/ngx-indexed-db.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n// rxjs\nimport { Observable } from 'rxjs/Observable';\nimport { Observer } from 'rxjs/Observer';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NgxIndexedDbService {\n\n  /**\n   * The Database\n   *\n   */\n  db: IDBDatabase;\n\n  constructor() { }\n\n  /**\n   * Opens the database.\n   *\n   */\n\n  openDBAsync(dbName: string, objectStore: string, version: number): Observable<any> {\n    return new Observable((observer: Observer<string>) => {\n      // Opens DB.\n      const request: IDBOpenDBRequest = indexedDB.open(dbName, version);\n      // Success.\n      request.onsuccess = (event: Event) => {\n        this.db = (<IDBOpenDBRequest>event.target).result;\n        observer.next((<IDBOpenDBRequest>event.target).readyState);\n        observer.complete();\n      };\n      // Error.\n      request.onerror = (event: Event) => {\n        console.error('IndexedDB service: ', (<IDBOpenDBRequest>event.target).error.name);\n        observer.error((<IDBOpenDBRequest>event.target).error.name);\n      };\n      // DB does not exist, create it.\n      request.onupgradeneeded = (event: Event) => {\n        this.db = (<IDBOpenDBRequest>event.target).result;\n        // ObjectStore and calls the createStares method\n        const object: IDBObjectStore = this.db.createObjectStore(objectStore, {autoIncrement: false});\n      };\n      // IDBOpenDBRequest is blocked\n      request.onblocked = (event: Event) => {\n        console.error('IndexedDB service: ', (<IDBOpenDBRequest>event.target).error.name);\n        observer.error((<IDBOpenDBRequest>event.target).error.name);\n      };\n    });\n  }\n\n  /**\n   * Gets the object store.\n   *\n   */\n\n  private getObjectStore(storeName: string, mode: IDBTransactionMode) {\n    const tx: IDBTransaction = this.db.transaction(storeName, mode);\n    return tx.objectStore(storeName);\n  }\n\n  /**\n   * Gets all records.\n   *\n   */\n\n  getAllRecordsAsync(storeName: string) {\n    // Gets object store.\n    const store: IDBObjectStore = this.getObjectStore(storeName, 'readonly');\n\n    return new Observable((observer: Observer<any>) => {\n      // Open cursor\n      const request: IDBRequest = store.openCursor();\n      // Success.\n      request.onsuccess = (event: Event) => {\n        const cursor: IDBCursorWithValue = (<IDBRequest>event.target).result;\n        if (cursor) {\n          observer.next({key: cursor.key, value: cursor.value});\n          cursor.continue();\n        } else {\n          observer.complete();\n        }\n      };\n      // Error.\n      request.onerror = (event: Event) => {\n        console.error('IndexedDB service:', (<IDBRequest>event.target).error.name);\n        observer.error((<IDBRequest>event.target).error.name);\n      };\n    });\n  }\n\n  /**\n   * Gets record by key.\n   *\n   */\n\n  getRecordAsync(storeName: string, key: string) {\n    // Gets the object store.\n    const store: IDBObjectStore = this.getObjectStore(storeName, 'readonly');\n\n    return new Observable((observer: Observer<any>) => {\n      // Gets record by key.\n      const request: IDBRequest = store.get(key);\n      // Success.\n      request.onsuccess = (event: Event) => {\n        observer.next(request.result);\n        observer.complete();\n      };\n      // Error.\n      request.onerror = (event: Event) => {\n        console.error('IndexedDB service:', (<IDBRequest>event.target).error.name);\n        observer.error((<IDBRequest>event.target).error.name);\n      };\n    });\n  }\n\n  /**\n   * Adds a record.\n   *\n   */\n\n  addRecordAsync(storeName: string, key: string, record: any) {\n    // Gets the object store.\n    const store: IDBObjectStore = this.getObjectStore(storeName, 'readwrite');\n\n    return new Observable((observer: Observer<string>) => {\n      // Adds a new record.\n      const request: IDBRequest = store.put(record, key); // insert or update (put), different from (add)\n      // Sucess.\n      request.onsuccess = (event: Event) => {\n        observer.next((<IDBRequest>event.target).readyState);\n        observer.complete();\n      };\n      // Error.\n      request.onerror = (event: Event) => {\n        console.error('IndexedDB Service:', (<IDBRequest>event.target).error.name);\n        observer.error((<IDBRequest>event.target).error.name);\n      };\n    });\n  }\n\n  /**\n   * Deletes a record.\n   *\n   */\n\n  deleteRecordAsync(storeName: string, key: string) {\n    // Gets the object store.\n    const store: IDBObjectStore = this.getObjectStore(storeName, 'readwrite');\n\n    return new Observable((observer: Observer<string>) => {\n        const request: IDBRequest = store.delete(key); // Deletes the record by the key.\n        // Success.\n        request.onsuccess = (event: Event) => {\n            // console.log('SUCCESS EVENT', event);\n            observer.next((<IDBRequest>event.target).readyState);\n            observer.complete();\n\n        };\n        // Error.\n        request.onerror = (event: Event) => {\n            console.error('IndexedDB service:', (<IDBRequest>event.target).error.name);\n            observer.error((<IDBRequest>event.target).error.name);\n        };\n    });\n  }\n\n  /**\n   * Edits a record.\n   *\n   */\n\n  editRecordAsync(storeName: string, key: string, record: any) {\n    // redundant (addRecordAsync use IDBObjectStore.put function to add or change)\n    return this.addRecordAsync(storeName, key, record);\n  }\n\n  /**\n   * Clears an object store\n   *\n   */\n\n  clearObjectStoreAsync(storeName: string) {\n    // Gets the object store.\n    const store: IDBObjectStore = this.getObjectStore(storeName, 'readwrite');\n\n    return new Observable((observer: Observer<string>) => {\n      // Clear  store.\n      const request: IDBRequest = store.clear(); // Clears the object store.\n        // Success.\n        request.onsuccess = (event: Event) => {\n            observer.next((<IDBRequest>event.target).readyState);\n            observer.complete();\n        };\n        // Error.\n        request.onerror = (event: Event) => {\n            console.error('IndexedDB service:', (<IDBRequest>event.target).error.name);\n            observer.error((<IDBRequest>event.target).error.name);\n        };\n    });\n  }\n\n  /**\n   * Closes the database;\n   *\n   */\n\n  closeDB() {\n    this.db.close();\n  }\n\n}\n","import { NgModule } from '@angular/core';\n\n@NgModule({\n  declarations: [],\n  imports: [\n  ],\n  exports: []\n})\nexport class NgxIndexedDbModule { }\n"],"names":[],"mappings":"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"}